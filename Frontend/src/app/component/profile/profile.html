<div class="page">
  <div class="container">
    <h2>Mon profil</h2>

    <!-- Loading -->
    <div class="loading" *ngIf="loading">Chargement…</div>

    <!-- Erreur -->
    <div class="errorMsg" *ngIf="error">{{ error }}</div>

    <!-- Succès -->
    <div class="successMsg" *ngIf="success">{{ success }}</div>

    <!-- Contenu principal -->
    <div *ngIf="me">

      <!-- Bloc Avatar -->
      <section class="card">
        <h3>Avatar</h3>
        <div class="avatarSection">
          <div class="avatarPreview">
            <img
              *ngIf="avatarSrc() as src; else noAvatar"
              [src]="src"
              alt="Avatar"
            />
            <ng-template #noAvatar>
              <span class="noAvatarText">Aucun avatar</span>
            </ng-template>
          </div>

          <div class="avatarUpload">
            <input
              type="file"
              name="avatarFile"
              accept="image/*"
              (change)="onFileSelected($event)"
              [disabled]="uploading"
            />
            <div class="uploadingText" *ngIf="uploading">Upload…</div>
          </div>
        </div>
      </section>

      <!-- Bloc Informations -->
      <section class="card">
        <h3>Informations</h3>
        <div class="formGrid">
          <div class="field">
            <label>Email</label>
            <input type="email" name="email" [(ngModel)]="form.email" />
          </div>

          <div class="field">
            <label>Twitch URL</label>
            <input type="text" name="twitchUrl" [(ngModel)]="form.twitch_url" placeholder="https://twitch.tv/..." />
          </div>

          <button class="btn primary" type="button" (click)="saveProfile()" [disabled]="saving || uploading">
            {{ saving ? 'Enregistrement…' : 'Enregistrer' }}
          </button>
        </div>
      </section>

      <!-- Bloc Mot de passe -->
      <section class="card">
        <h3>Mot de passe</h3>
        <div class="formGrid">
          <div class="field">
            <label>Mot de passe actuel</label>
            <input type="password" name="currentPassword" [(ngModel)]="pwd.currentPassword" />
          </div>

          <div class="field">
            <label>Nouveau mot de passe</label>
            <input type="password" name="newPassword" [(ngModel)]="pwd.newPassword" />
          </div>

          <div class="field">
            <label>Confirmer nouveau mot de passe</label>
            <input type="password" name="confirmNewPassword" [(ngModel)]="pwd.confirmNewPassword" />
          </div>

          <button class="btn primary" type="button" (click)="changePassword()" [disabled]="changingPwd">
            {{ changingPwd ? 'Changement…' : 'Changer le mot de passe' }}
          </button>
        </div>
      </section>

    </div>
  </div>
</div>

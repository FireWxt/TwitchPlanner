<!-- BARRE DE NAVIGATION -->
<div class="topBar">
  <div class="logo">TwitchPlanner</div>
  <a routerLink="/profile" class="profileBox">
    <span class="profileIcon">ğŸ‘¤</span>
    <span class="profileText">Mon profil</span>
  </a>
</div>

<!-- HEADER -->
<div class="planningHeader" *ngIf="planning">
  <div class="left">
    <button class="backBtn" (click)="backToList()">â† Retour</button>
    <div class="title">{{ planning.title }}</div>
    <div class="range">
      {{ formatPlanningRange(planning.start_date, planning.end_date) }}
    </div>
  </div>

  <div class="right">
    <div class="logo">Logo</div>
    <div class="avatar">ğŸ‘¤</div>
  </div>
</div>

<!-- SI PAS DE PLANNING SELECTIONNE -->
<div *ngIf="!planning && !loading" class="empty">
  <h2>CrÃ©er un planning</h2>

  <label>Titre</label>
  <input [(ngModel)]="planningForm.title" />

  <label>DÃ©but</label>
  <input type="date" [(ngModel)]="planningForm.start_date" [min]="minStartDate" />

  <button (click)="createPlanning()">CrÃ©er</button>

  <div class="error" *ngIf="error">{{ error }}</div>

  <!-- LISTE DES PLANNINGS -->
  <div class="planningList" *ngIf="plannings.length > 0">
    <h3>Mes plannings</h3>
    <div class="planningItem" *ngFor="let p of plannings">
      <div class="planningItemInfo">
        <div class="planningItemTitle">{{ p.title }}</div>
        <div class="planningItemDates">{{ formatPlanningRange(p.start_date, p.end_date) }}</div>
      </div>
      <div class="planningItemActions">
        <button class="btnEdit" (click)="selectPlanning(p)" title="Modifier">Modifier</button>
        <button class="btnDelete" (click)="deletePlanningById(p.Id_Planning, $event)" title="Supprimer">Supprimer</button>
      </div>
    </div>
  </div>

  <div *ngIf="plannings.length === 0" class="noPlannings">
    Aucun planning pour le moment.
  </div>
</div>

<!-- CHARGEMENT -->
<div *ngIf="loading" class="loading">Chargement...</div>

<!-- GRILLE (Lunâ†’Dim) -->
<div class="weekGrid" *ngIf="planning">
  <div class="dayCol" *ngFor="let d of days">

    <div class="dayHeader">{{ d.label }}</div>

    <button class="addSlot" (click)="openAddEvent(d.value)">+</button>

    <!-- events -->
    <div class="eventCard" *ngFor="let ev of getEventsForDay(d.value)">
      <div class="time">{{ ev.start_time }}</div>
      <div class="name">{{ ev.stream_title }}</div>

      <button class="trash" (click)="deleteEvenement(getEventId(ev))">ğŸ—‘</button>
    </div>

    <!-- OFF si aucun event -->
    <div class="off" *ngIf="getEventsForDay(d.value).length === 0">
      OFF
    </div>

  </div>
</div>

<!-- MODAL AJOUT EVENT -->
<div class="modalBackdrop" *ngIf="showEventForm">
  <div class="modal">
    <h3>Ajouter un crÃ©neau</h3>

    <label>Titre</label>
    <input [(ngModel)]="eventForm.stream_title" />

    <label>Heure dÃ©but</label>
    <input type="time" [(ngModel)]="eventForm.start_time" />

    <label>Heure fin</label>
    <input type="time" [(ngModel)]="eventForm.end_time" />

    <div class="actions">
      <button (click)="addEvenement()">Ajouter</button>
      <button (click)="closeAddEvent()">Annuler</button>
    </div>
  </div>
</div>
